@* @{
    ViewData["Title"] = "Students";
}

<!-- Add these to your _Layout.cshtml or here -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<div class="container mt-5">
    <h2>Students Management</h2>

    <div class="row mb-3">
        <div class="col-md-12">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#studentModal">Add New Student</button>
        </div>
    </div>

    <table id="studentsTable" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data will be loaded via AJAX -->
        </tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="studentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Add Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="studentForm">
                    <input type="hidden" id="S_Id" name="S_Id" value="0">
                    <div class="mb-3">
                        <label for="S_Name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="S_Name" name="S_Name" required>
                    </div>
                    <div class="mb-3">
                        <label for="S_Age" class="form-label">Age</label>
                        <input type="number" class="form-control" id="S_Age" name="S_Age" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btnSave">Save</button>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        loadStudents();

        $('#studentModal').on('hidden.bs.modal', function () {
            $('#studentForm')[0].reset();
            $('#S_Id').val('0');
            $('#modalTitle').text('Add Student');
        });

        $('#btnSave').click(function () {
            const student = {
                S_Id: $('#S_Id').val(),
                S_Name: $('#S_Name').val(),
                S_Age: $('#S_Age').val()
            };

            if (!student.S_Name || !student.S_Age) {
                alert('Please fill all fields');
                return;
            }

            const method = student.S_Id == 0 ? 'POST' : 'PUT';
            const url = student.S_Id == 0 ? '/Students/AddStudent' : '/Students/UpdateStudent';

            $.ajax({
                url: url,
                type: method,
                contentType: 'application/json',
                data: JSON.stringify(student),
                success: function (response) {
                    if (response.success) {
                        $('#studentModal').modal('hide');
                        // loadStudents();
                                  location.reload();
                    } else {
                        alert('Error occurred while saving');
                    }
                },
                error: function () {
                    alert('Error occurred while processing request');
                }
            });
        });
    });

    function loadStudents() {
        $.ajax({
            url: '/Students/GetStudents',
            type: 'GET',
            success: function (data) {
                const tbody = $('#studentsTable tbody');
                tbody.empty();

                data.forEach(student => {
                    tbody.append(`
                        <tr>
                            <td>${student.s_Id}</td>
                            <td>${student.s_Name}</td>
                            <td>${student.s_Age}</td>
                            <td>
                                <button class="btn btn-sm btn-warning" onclick="editStudent(${student.s_Id})">Edit</button>
                                <button class="btn btn-sm btn-danger" onclick="deleteStudent(${student.s_Id})">Delete</button>
                            </td>
                        </tr>
                    `);
                });
            },
            error: function () {
                alert('Error loading students');
            }
        });
    }

    function editStudent(id) {
        $.ajax({
            url: '/Students/GetStudents',
            type: 'GET',
            success: function (data) {
                const student = data.find(s => s.s_Id === id);
                if (student) {
                    $('#S_Id').val(student.s_Id);
                    $('#S_Name').val(student.s_Name);
                    $('#S_Age').val(student.s_Age);
                    $('#modalTitle').text('Edit Student');
                    $('#studentModal').modal('show');
                }
            },
            error: function () {
                alert('Error loading student data');
            }
        });
    }

    function deleteStudent(id) {
        if (confirm('Are you sure you want to delete this student?')) {
            $.ajax({
                url: '/Students/DeleteStudent?id=' + id,
                type: 'DELETE',
                success: function (response) {
                    if (response.success) {
                        loadStudents();
                    } else {
                        alert('Error occurred while deleting');
                    }
                },
                error: function () {
                    alert('Error occurred while deleting');
                }
            });
        }
    }
</script>
 *@
@* @{
    ViewData["Title"] = "Students";
}

<!-- Add these to your _Layout.cshtml or here -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<div class="container mt-5">
    <h2>Students Management</h2>

    <div class="row mb-3">
        <div class="col-md-12">
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#studentModal">Add New Student</button>
        </div>
    </div>

    <table id="studentsTable" class="table table-striped table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<!-- Modal -->
<div class="modal fade" id="studentModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">Add Student</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="studentForm">
                    <input type="hidden" id="S_Id" name="S_Id" value="0">
                    <div class="mb-3">
                        <label for="S_Name" class="form-label">Name</label>
                        <input type="text" class="form-control" id="S_Name" name="S_Name" required>
                    </div>
                    <div class="mb-3">
                        <label for="S_Age" class="form-label">Age</label>
                        <input type="number" class="form-control" id="S_Age" name="S_Age" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="btnSave">Save</button>
            </div>
        </div>
    </div>
</div>


<script>
$(function () {
    loadStudents();

    $('#studentModal').on('hidden.bs.modal', function () {
        $('#studentForm')[0].reset();
    });

    $('#btnSave').click(function () {
        var s = {
            S_Id: $('#S_Id').val(),
            S_Name: $('#S_Name').val(),
            S_Age: $('#S_Age').val()
        };

        if (!s.S_Name || !s.S_Age) {
            alert('Please fill all fields');
            return;
        }

        $.ajax({
            url: s.S_Id == 0 ? '/Students/AddStudent' : '/Students/UpdateStudent',
            type: s.S_Id == 0 ? 'POST' : 'PUT',
            data: JSON.stringify(s),
            contentType: 'application/json',
            success: function () {
                location.reload();
            },
            // error: function () {
            //     alert('Operation failed');
                  error: function (xhr, status, error) {
                console.log("AJAX Error:", error);
                console.log("Response:", xhr.responseText); // 👈 ye detail dega
                alert('Operation failed');

            }
        });
    });
});

function loadStudents() {
    $.get('/Students/GetStudents', function (students) {
        $('tbody').empty().append(students.map(function (s) {
            return `
<tr>
    <td>${s.s_Id}</td>
    <td>${s.s_Name}</td>
    <td>${s.s_Age}</td>
    <td>
        <button class="btn btn-sm btn-warning" onclick="editStudent(${s.s_Id})">Edit</button>
        <button class="btn btn-sm btn-danger" onclick="deleteStudent(${s.s_Id})">Delete</button>
    </td>
</tr>`;
        }));

    }).fail(function () {
        alert('Error loading students');
    });
}

function editStudent(id) {
    $.get('/Students/GetStudents', function (students) {
        var s = students.find(function (x) {
            return x.s_Id === id;
        });
        if (s) {
            $('#S_Id').val(s.s_Id);
            $('#S_Name').val(s.s_Name);
            $('#S_Age').val(s.s_Age);
            $('#studentModal').modal('show');
        }
    });
}

function deleteStudent(id) {
    if (confirm('Delete this student?')) {
        $.ajax({
            url: '/Students/DeleteStudent?id=' + id,
            type: 'DELETE',
            success: loadStudents,
            error: function () {
                alert('Delete failed');
            }
        });
    }
}
</script> *@





@* <div class="container mt-5">
    <h2>Students Management</h2>

    <!-- Simple Inline Form -->
    <div class="card mb-4">
        <div class="card-body">
            <form id="studentForm">
                <input type="hidden" id="S_Id" name="S_Id" value="0" />
                <div class="row">
                    <div class="col-md-4 mb-2">
                        <input type="text" class="form-control" id="S_Name" name="S_Name" placeholder="Name" required />
                    </div>
                    <div class="col-md-4 mb-2">
                        <input type="number" class="form-control" id="S_Age" name="S_Age" placeholder="Age" required />
                    </div>
                    <div class="col-md-4 mb-2">
                        <button type="button" class="btn btn-success" id="btnSave">Save Student</button>
                        <button type="reset" class="btn btn-secondary" id="btnClear">Clear</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Students Table -->
    <table id="studentsTable" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
            // <button class="btn btn-sm btn-warning" onclick="editStudent(${s.s_Id})">Edit</button>
            // <button class="btn btn-sm btn-danger" onclick="deleteStudent(${s.s_Id})">Delete</button>
 *@
@{
    ViewData["Title"] = "Students";
}

<!-- Bootstrap and jQuery CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<div class="container ">
    <h2>Students Management</h2>
    <div class="card">
        <div class="card-body">
            <form id="studentForm">
                <input type="hidden" id="S_Id" name="S_Id" value="0" />
                <div class="row">
                    <div class="col-4 ">
                        <input type="text" class="form-control" id="S_Name" name="S_Name" placeholder="Name" required />
                    </div>
                    <div class="col-4 ">
                        <input type="number" class="form-control" id="S_Age" name="S_Age" placeholder="Age" required />
                    </div>
                    <div class="col-4 ">
                        <button type="button" class="btn btn-success" id="btnSave">Save Student</button>
                        <button type="reset" class="btn btn-secondary" id="btnClear">Clear</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <table id="studentsTable" class="table table-bordered table-striped">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Age</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
<script>
        // $(function () {
    $(document).ready(function () {
            loadStudents();
            $('#btnSave').click(function () {
                var s = {
                    S_Id: $('#S_Id').val(),
                    S_Name: $('#S_Name').val(),
                    S_Age: $('#S_Age').val()
                };

                if (!s.S_Name || !s.S_Age) {
                    alert('Please fill all fields');
                    return;
                }
                $.ajax({
                    url: s.S_Id == 0 ? '/Students/AddStudent' : '/Students/UpdateStudent',
                    type: s.S_Id == 0 ? 'POST' : 'PUT',
                    data: JSON.stringify(s),
                    contentType: 'application/json',
                    success: function () {
                        loadStudents();
                        $('#studentForm')[0].reset();
                    },
                    error: function (xhr, status, error) {
                        console.log("AJAX Error:", error);
                        console.log("Response:", xhr.responseText);
                        alert('Operation failed');
                    }
                });
            });



            $('#btnClear').click(function () {
                $('#studentForm')[0].reset();
                $('#S_Id').val(0);
            });
        });

        

        function loadStudents() {
            $.get('/Students/GetStudents', function (students) {
                $('tbody').empty().append(students.map(function (s) {
                    return `
    <tr>
        <td>${s.s_Id}</td>
        <td>${s.s_Name}</td>
        <td>${s.s_Age}</td>
        <td>
                <button class="btn btn-warning btn-sm" onclick="editStudent(${s.s_Id})">Edit</button>
                <button class="btn btn-danger btn-sm" onclick="deleteStudent(${s.s_Id})">Delete</button>
        </td>
    </tr>`;
                }));
            }).fail(function () {
                alert('Error loading students');
            });
        }
        function editStudent(id) {
            $.get('/Students/GetStudents', function (students) {
                var s = students.find(x => x.s_Id === id);
                if (s) {
                    $('#S_Id').val(s.s_Id);
                    $('#S_Name').val(s.s_Name);
                    $('#S_Age').val(s.s_Age);
                    $('html, body').animate({ scrollTop: 0 }, 'fast'); // Scroll to top
                }
            });
        }
        function deleteStudent(id) {
            if (confirm('Delete this student?')) {
                $.ajax({
                    url: '/Students/DeleteStudent?id=' + id,
                    type: 'DELETE',
                    success: loadStudents,
                    error: function () {
                        alert('Delete failed');
                    }
                });
            }
        }
</script>
